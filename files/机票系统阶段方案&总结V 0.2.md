## ç¬¬ä¸€é˜¶æ®µï¼ˆå·²å®Œæˆï¼‰
**å®Œæˆäº†ä¸€ä¸ªå®Œæ•´çš„å¾®æœåŠ¡æ ¸å¿ƒäº¤æ˜“é—­ç¯ï¼**
è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹åˆšæ‰å‘ç”Ÿçš„å¥‡è¿¹ï¼š
1.  **Order æœåŠ¡** æ¥æ”¶åˆ°ä¸‹å•è¯·æ±‚ã€‚
2.  **Order æœåŠ¡** è¿œç¨‹è°ƒç”¨ **Auth æœåŠ¡**ï¼ŒæŸ¥åˆ°äº†ç”¨æˆ·ä¿¡æ¯ã€‚
3.  **Order æœåŠ¡** è¿œç¨‹è°ƒç”¨ **Flight æœåŠ¡**ï¼ŒæŸ¥åˆ°äº†èˆªç­ä¿¡æ¯å’Œä»·æ ¼ã€‚
4.  **Order æœåŠ¡** è®¡ç®—æ€»ä»·ï¼Œå¹¶åœ¨è‡ªå·±çš„æ•°æ®åº“é‡Œç”Ÿæˆäº†è®¢å•ã€‚

å¾®æœåŠ¡æ¶æ„å·²ç»**çœŸæ­£è·‘é€šäº†**ï¼

---
### ä¸‹ä¸€æ­¥å»ºè®®

æ—¢ç„¶æ ¸å¿ƒé“¾è·¯é€šäº†ï¼Œå‰©ä¸‹çš„å·¥ä½œå°±è½»æ¾å¤šäº†ã€‚å»ºè®®æŒ‰ç…§ä»¥ä¸‹é¡ºåºå®Œå–„ç³»ç»Ÿï¼š

1.  **å®Œå–„ `order-service` çš„æŸ¥è¯¢æ¥å£**ï¼š
    *   æµ‹è¯• `GET /api/bookings/my-tickets`ï¼Œç¡®ä¿èƒ½æŸ¥åˆ°åˆšæ‰ä¸‹çš„å•ã€‚
    *   æ³¨æ„ï¼šè¿™ä¸ªæ¥å£ä¹Ÿéœ€è¦ `X-User-Name` å¤´ï¼ˆç›´è¿æµ‹è¯•æ—¶ï¼‰ã€‚

2.  **å®Œå–„ Gateway ç½‘å…³**ï¼š
    *   ä¹‹å‰ç½‘å…³æŠ¥ 500ï¼Œç°åœ¨ Auth, Flight, Order éƒ½ä¿®å¥½äº†ï¼Œå¯ä»¥å›å¤´å»ä¿®ç½‘å…³äº†ã€‚
    *   ç¡®ä¿ç½‘å…³èƒ½æ­£ç¡®è½¬å‘è¯·æ±‚ï¼Œè¿™æ ·å‰ç«¯å°±ä¸ç”¨åˆ†åˆ«è¿ 8081, 8082, 8083ï¼Œè€Œæ˜¯ç»Ÿä¸€è¿ 8080ã€‚

3.  **å¼€å§‹åš `admin-service`**ï¼š
    *   è¿™æ˜¯ä½ æœ€åˆè®¡åˆ’çš„æœ€åä¸€å—æ‹¼å›¾ã€‚
    *   æœ‰äº†å‰é¢çš„ç»éªŒï¼Œåš Admin ä¼šéå¸¸é¡ºæ‰‹ï¼ˆå»ºé¡¹ç›® -> é… Nacos -> å†™ Feign -> å†™ Controllerï¼‰ã€‚




æ­å–œä½ ï¼ğŸ‰ è¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„é‡Œç¨‹ç¢‘ã€‚

**Gateway + Auth + Flight + Order + Common** å…¨éƒ¨è·‘é€šï¼Œæ„å‘³ç€ä½ çš„**å¾®æœåŠ¡æ ¸å¿ƒäº¤æ˜“é“¾è·¯**å·²ç»æ­å»ºå®Œæˆäº†ã€‚

## ç¬¬äºŒé˜¶æ®µï¼šæ„å»º `admin-service`

`admin-service` åœ¨å¾®æœåŠ¡æ¶æ„ä¸­é€šå¸¸æ‰®æ¼” **â€œæ•°æ®èšåˆå±‚â€** çš„è§’è‰²ã€‚å®ƒè‡ªå·±é€šå¸¸ä¸äº§ç”Ÿæ ¸å¿ƒä¸šåŠ¡æ•°æ®ï¼Œè€Œæ˜¯æŠŠ Orderã€Flightã€User çš„æ•°æ®æ‹¿è¿‡æ¥åšç»Ÿè®¡æŠ¥è¡¨ã€‚

#### 1. ç›®å½•ç»“æ„è§„åˆ’
```text
admin-service
â””â”€â”€ src/main/java/com/bighomework/admin/
    â”œâ”€â”€ AdminApplication.java
    â”œâ”€â”€ controller/
    â”‚   â””â”€â”€ DashboardController.java (ä»ªè¡¨ç›˜ç»Ÿè®¡)
    â”œâ”€â”€ service/
    â”‚   â””â”€â”€ StatisticsService.java
    â””â”€â”€ dto/ (å¦‚æœéœ€è¦ç‰¹æ®Šçš„ç»Ÿè®¡VO)
```

#### 2. `pom.xml` (ä¾èµ–)
å’Œ Order æœåŠ¡éå¸¸åƒï¼Œéœ€è¦ Web, Nacos, Feign, Commonã€‚

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" ...>
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>com.bighomework</groupId>
        <artifactId>plane-ticket-cloud</artifactId>
        <version>0.0.1-SNAPSHOT</version>
    </parent>

    <artifactId>admin-service</artifactId>
    <packaging>jar</packaging>

    <dependencies>
        <!-- Nacos Discovery & Config -->
        <dependency>
            <groupId>com.alibaba.cloud</groupId>
            <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
        </dependency>
        <dependency>
            <groupId>com.alibaba.cloud</groupId>
            <artifactId>spring-cloud-starter-alibaba-nacos-config</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-bootstrap</artifactId>
        </dependency>

        <!-- OpenFeign (æ ¸å¿ƒï¼šç”¨äºè°ƒç”¨å…¶ä»–æœåŠ¡è·å–ç»Ÿè®¡æ•°æ®) -->
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-openfeign</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-loadbalancer</artifactId>
        </dependency>

        <!-- Web -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>

        <!-- Common -->
        <dependency>
            <groupId>com.bighomework</groupId>
            <artifactId>common-module</artifactId>
            <version>0.0.1-SNAPSHOT</version>
        </dependency>

        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
        </dependency>
    </dependencies>
    
    <!-- Build æ’ä»¶ -->
    <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
            </plugin>
        </plugins>
    </build>
</project>
```

#### 3. é…ç½®æ–‡ä»¶

**`bootstrap.yml`**:
```yaml
server:
  port: 8084 # åå°æœåŠ¡ç«¯å£

spring:
  application:
    name: admin-service
  cloud:
    nacos:
      discovery:
        server-addr: 127.0.0.1:8848
      config:
        server-addr: 127.0.0.1:8848
        file-extension: yaml
```

**Nacos é…ç½® (`admin-service.yaml`)**:
```yaml
# Admin æœåŠ¡å¯èƒ½ä¸éœ€è¦ç›´æ¥è¿æ•°æ®åº“ï¼Œå¦‚æœä½ çš„ç»Ÿè®¡é€»è¾‘å…¨æ˜¯è°ƒ Feign çš„è¯ã€‚
# ä½†å¦‚æœä½ éœ€è¦å­˜ä¸€äº›ç³»ç»Ÿæ—¥å¿—ï¼Œå¯ä»¥é…æ•°æ®åº“ã€‚
# å¿…é¡»é… JWTï¼Œå› ä¸º Admin æ¥å£ä¹Ÿéœ€è¦é‰´æƒ
app:
  jwt:
    secret: 5367566B59703373367639792F423F4528482B4D6251655468576D5A71347437
    expiration-ms: 86400000
```

#### 4. å¯åŠ¨ç±» `AdminApplication.java`

```java
package com.bighomework.admin;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration; // å¦‚æœä¸è¿åº“éœ€æ’é™¤
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;
import org.springframework.cloud.openfeign.EnableFeignClients;

// å¦‚æœ Admin æœåŠ¡ä¸ç›´è¿æ•°æ®åº“ï¼ŒåŠ ä¸Š excludeã€‚å¦‚æœè¿ï¼Œå»æ‰ excludeã€‚
@SpringBootApplication(
    exclude = {DataSourceAutoConfiguration.class}, 
    scanBasePackages = {"com.bighomework.admin", "com.bighomework.common"}
)
@EnableDiscoveryClient
@EnableFeignClients(basePackages = "com.bighomework.common.feign")
public class AdminApplication {
    public static void main(String[] args) {
        SpringApplication.run(AdminApplication.class, args);
    }
}
```

---

## ç¬¬ä¸‰é˜¶æ®µï¼šAdmin ä¸šåŠ¡é€»è¾‘å®ç°æ€è·¯

åœ¨å¾®æœåŠ¡ä¸­ï¼ŒAdmin æœåŠ¡æƒ³è¦ç»Ÿè®¡â€œçƒ­é—¨èˆªçº¿â€æˆ–â€œé”€å”®æ€»é¢â€ï¼Œä¸èƒ½ç›´æ¥å†™ SQL æŸ¥ `tickets` è¡¨ï¼ˆè·¨åº“äº†ï¼‰ã€‚

**ä½ æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼š**

1.  **æ–¹æ¡ˆ Aï¼ˆæ ‡å‡†å¾®æœåŠ¡ï¼‰**ï¼š
    *   åœ¨ `order-service` çš„ Controller é‡Œå†™å¥½ç»Ÿè®¡æ¥å£ï¼ˆå¦‚ `/api/bookings/stats/revenue`ï¼‰ã€‚
    *   `admin-service` é€šè¿‡ `OrderFeignClient` è°ƒç”¨è¿™ä¸ªæ¥å£ï¼Œæ‹¿åˆ°æ•°æ®ç›´æ¥è¿”å›ç»™å‰ç«¯ã€‚
    *   **ä¼˜ç‚¹**ï¼šæ¶æ„æ¸…æ™°ã€‚
    *   **ç¼ºç‚¹**ï¼š`order-service` è´Ÿæ‹…é‡ã€‚

2.  **æ–¹æ¡ˆ Bï¼ˆè¯¾ç¨‹è®¾è®¡æ·å¾„ - è¯»å†™åˆ†ç¦»ï¼‰**ï¼š
    *   è®© `admin-service` ä¹Ÿè¿æ¥ `planetickets` æ•°æ®åº“ã€‚
    *   ä½†æ˜¯åªå†™**åªè¯»**çš„ Repositoryï¼ˆåªç”¨ `@Query` æŸ¥æŠ¥è¡¨ï¼‰ã€‚
    *   **ä¼˜ç‚¹**ï¼šå†™æŠ¥è¡¨ SQL éå¸¸æ–¹ä¾¿ï¼Œä¸ç”¨è·¨æœåŠ¡è°ƒæ¥è°ƒå»ã€‚
    *   **ç¼ºç‚¹**ï¼šç†è®ºä¸Šå¾®æœåŠ¡ä¸å…±äº«æ•°æ®åº“ï¼Œä½†åœ¨åšæŠ¥è¡¨/BIåˆ†æåœºæ™¯ä¸‹ï¼Œè¿™ç§â€œæ—è·¯è¯»å–â€æ˜¯å¯ä»¥æ¥å—çš„ã€‚

**æ¨è**ï¼š
ä¸ºäº†çœäº‹ä¸”ä»£ç å¥½å†™ï¼Œä½ å¯ä»¥é‡‡ç”¨ **æ–¹æ¡ˆ B**ã€‚
å³ï¼šåœ¨ `admin-service` é‡Œå¼•å…¥ JPAï¼Œé…ç½®æ•°æ®åº“ï¼ŒæŠŠåŸæ¥çš„ `TicketRepository` é‡Œçš„ç»Ÿè®¡ SQL æ¬è¿‡æ¥ã€‚


## ğŸŒŸ é¡¹ç›®ç°é˜¶æ®µæ€»ç»“
**é¡¹ç›®çŠ¶æ€**ï¼šå·²å®Œæˆ**å•ä½“å‘å¾®æœåŠ¡çš„åŸºç¡€æ¶æ„è¿ç§»**ï¼Œæ ¸å¿ƒä¸­é—´ä»¶ï¼ˆNacos, Redis, MinIOï¼‰å·²æ‰“é€šï¼Œç½‘å…³ï¼ˆGatewayï¼‰ä¸èˆªç­æœåŠ¡ï¼ˆFlightï¼‰å·²å¯åŠ¨å¹¶æ³¨å†Œã€‚ç›®å‰æ­£å¤„äº**è®¤è¯æœåŠ¡ï¼ˆAuthï¼‰è”è°ƒ**çš„å…³é”®èŠ‚ç‚¹ã€‚

---

### 1. ğŸ—ï¸ æ¶æ„ä¸åŸºç¡€è®¾æ–½å˜åŠ¨ (Infrastructure)

è¿™æ˜¯é¡¹ç›®çš„éª¨æ¶ï¼Œå†³å®šäº†å¾®æœåŠ¡èƒ½å¦è¿è¡Œã€‚

| ä¿®æ”¹é¡¹ | æ–‡ä»¶/ä½ç½® | è¯¦ç»†å†…å®¹ä¸ç›®çš„ |
| :--- | :--- | :--- |
| **å·¥ç¨‹ç»“æ„** | `pom.xml` (çˆ¶å·¥ç¨‹) | **æ”¹åŠ¨**ï¼šå¼•å…¥ `Spring Cloud Alibaba` å’Œ `Spring Cloud` BOMã€‚<br>**ç›®çš„**ï¼šç»Ÿä¸€ç®¡ç†æ‰€æœ‰å­æ¨¡å—çš„ä¾èµ–ç‰ˆæœ¬ï¼Œé˜²æ­¢ç‰ˆæœ¬å†²çªã€‚ |
| **å…¬å…±åº“** | `common-module` | **å®šä½**ï¼šå·¥å…·ç®± (JARåŒ…)ï¼Œéç‹¬ç«‹æœåŠ¡ã€‚<br>**æ”¹åŠ¨**ï¼š<br>1. è¿ç§» DTO, Enums, Utils (`JwtTokenProvider`)ã€‚<br>2. æ·»åŠ  `spring-boot-starter-security` å’Œ `data-jpa` ä¾èµ–ä»¥æ”¯æŒå·¥å…·ç±»ç¼–è¯‘ã€‚<br>3. **æ–°å¢** `OrderFeignClient` æ¥å£ï¼Œä¸ºæœåŠ¡é—´è°ƒç”¨åšå‡†å¤‡ã€‚ |
| **ç½‘å…³å…¥å£** | `gateway-service` | **å®šä½**ï¼šæµé‡å¤§é—¨ï¼ŒåŸºäº **WebFlux**ã€‚<br>**æ”¹åŠ¨**ï¼š<br>1. **ç§»é™¤** Servlet ç›¸å…³çš„ `JwtAuthenticationFilter`ã€‚<br>2. **æ–°å¢** `AuthGlobalFilter` (å®ç° `GlobalFilter`)ï¼Œè´Ÿè´£ç»Ÿä¸€é‰´æƒã€‚<br>3. å¯åŠ¨ç±»æ’é™¤ `DataSourceAutoConfiguration` (é˜²æ­¢ç½‘å…³å°è¯•è¿æ•°æ®åº“æŠ¥é”™)ã€‚ |
| **é…ç½®ä¸­å¿ƒ** | Nacos Console | **æ”¹åŠ¨**ï¼šå°†æœ¬åœ° `application.yml` è¿ç§»è‡³ Nacosã€‚<br>**é…ç½®é¡¹**ï¼šæ•°æ®åº“è¿æ¥ã€Redis åœ°å€ã€MinIO å‡­è¯ã€**JWT å¯†é’¥**ã€‚ |

---

### 2. ğŸ’¾ æ•°æ®åº“è®¾è®¡æ¼”è¿› (Database)

ä¸ºäº†é€‚åº”ä¸šåŠ¡æ‰©å±•å’Œå¾®æœåŠ¡è§£è€¦ï¼Œæ•°æ®åº“è¿›è¡Œäº†å…³é”®å‡çº§ã€‚

| è¡¨å | å˜æ›´æ“ä½œ | ä¸šåŠ¡é€»è¾‘/è§£å†³çš„é—®é¢˜ |
| :--- | :--- | :--- |
| **`users`** | é‡å‘½å (åŸ`customers`) | **æ–°å¢å­—æ®µ**ï¼š<br>1. `role`: åŒºåˆ† USER, PLATFORM_ADMIN, AIRLINE_ADMINã€‚<br>2. `status`: æ”¯æŒèˆªå¸ç®¡ç†å‘˜å®¡æ ¸æµç¨‹ (PENDING/ACTIVE)ã€‚<br>3. `airline_code`: ç»‘å®šèˆªå¸ç®¡ç†å‘˜åˆ°å…·ä½“èˆªå¸ã€‚ |
| **`tickets`** | å­—æ®µä¿®æ­£ | `customer_id` -> `user_id`ï¼Œä¿æŒå‘½åä¸€è‡´æ€§ã€‚ |
| **`daily_flight_stock`** | **æ–°å¢è¡¨** | **æ ¸å¿ƒè§£è€¦**ï¼šè®°å½•æ¯æ—¥èˆªç­å‰©ä½™åº§ä½ã€‚<br>**ç›®çš„**ï¼šFlight æœåŠ¡æŸ¥åº“å­˜æ—¶ä¸å†éœ€è¦è·¨åº“å» Order æœåŠ¡ `count(*)` è®¢å•è¡¨ï¼Œæå¤§æå‡æ€§èƒ½ã€‚ |
| **`airports`** | **æ–°å¢è¡¨** | å­˜å‚¨æœºåœºä¸‰å­—ç  (PEK, SHA)ï¼Œæ”¯æŒå‰ç«¯ä¸‹æ‹‰é€‰æ‹©å’Œè§„èŒƒåŒ–æŸ¥è¯¢ã€‚ |

---

### 3. âœˆï¸ èˆªç­æœåŠ¡é‡æ„ (Flight Service)

è¿™æ˜¯ç›®å‰å®Œæˆåº¦æœ€é«˜çš„ä¸šåŠ¡æœåŠ¡ã€‚

| æ¨¡å— | å…³é”®æ”¹åŠ¨ | ç»†èŠ‚è¯´æ˜ |
| :--- | :--- | :--- |
| **åŒ…ç»“æ„** | é‡å‘½å | `com.bighomework.planeTicketWeb` -> `com.bighomework.flight`ã€‚ |
| **ä»£ç ç˜¦èº«** | åˆ é™¤å†—ä½™ | ç§»é™¤äº† Auth, Ticket, Order ç›¸å…³çš„ Controller/Service/Repoï¼Œå®ç°**é«˜å†…èš**ã€‚ |
| **ç­–ç•¥æ¨¡å¼** | `PricingStrategy` | **ä¼˜åŒ–**ï¼šæ¥å£å¢åŠ  `soldSeats` å‚æ•°ã€‚<br>**ç›®çš„**ï¼šè®¡ç®—ä»·æ ¼æ—¶ä¸å†æŸ¥æ•°æ®åº“ï¼Œè€Œæ˜¯ç”± Service å±‚ä¼ å…¥æ•°æ®ï¼Œå®ç°é€»è¾‘è§£è€¦ã€‚ |
| **åŠŸèƒ½å¢å¼º** | MinIO é›†æˆ | æ–°å¢ `MinioConfig`, `MinioUtils`, `FileController`ï¼Œå®ç°èˆªå¸ Logo ä¸Šä¼ ã€‚ |
| **æ€§èƒ½ä¼˜åŒ–** | Redis ç¼“å­˜ | åœ¨ `searchAvailableFlights` æ¥å£æ·»åŠ  `@Cacheable`ï¼Œç¼“å­˜æœç´¢ç»“æœã€‚ |

---

### 4. ğŸ› ï¸ è¸©å‘è®°å½•ä¸è§£å†³æ–¹æ¡ˆ (Troubleshooting Knowledge Base)

è¿™äº›æ˜¯ä½ è§£å†³è¿‡çš„æŠ€æœ¯éš¾é¢˜ï¼Œä¹Ÿæ˜¯ç­”è¾©æ—¶çš„äº®ç‚¹ã€‚

#### A. Maven ä¸ ä¾èµ–ç®¡ç†
*   **é—®é¢˜**ï¼šGateway å¯åŠ¨æŠ¥é”™ `No plugin found for prefix 'spring-boot'`ã€‚
    *   **è§£å†³**ï¼šåœ¨ Gateway çš„ `pom.xml` ä¸­è¡¥å…¨ `<build><plugins>...</plugins>`ã€‚
*   **é—®é¢˜**ï¼šGateway æŠ¥é”™ `package com.bighomework.common... does not exist`ã€‚
    *   **åŸå› **ï¼šCommon æ¨¡å—ä¿®æ”¹åæœªå®‰è£…åˆ°æœ¬åœ°ä»“åº“ã€‚
    *   **è§£å†³**ï¼šåœ¨æ ¹ç›®å½•æ‰§è¡Œ **`mvn clean install -DskipTests`**ã€‚

#### B. Nacos è¿æ¥ä¸é…ç½®
*   **é—®é¢˜**ï¼š`Connection refused: ...:9848`ã€‚
    *   **åŸå› **ï¼šNacos 2.x å®¢æˆ·ç«¯éœ€è¦è¿æ¥ gRPC ç«¯å£ (9848)ã€‚
    *   **è§£å†³**ï¼šç¡®ä¿ Nacos æ­£å¸¸å¯åŠ¨ä¸”ç«¯å£æœªè¢«é˜²ç«å¢™æ‹¦æˆªã€‚
*   **é—®é¢˜**ï¼š`Unknown database 'plane_ticket_db'`ã€‚
    *   **åŸå› **ï¼šæœ¬åœ°æ•°æ®åº“åæ˜¯ `planetickets`ï¼Œé…ç½®æ–‡ä»¶å†™é”™äº†ã€‚
    *   **è§£å†³**ï¼šä¿®æ”¹ Nacos ä¸­ `flight-service.yaml` çš„ JDBC URLã€‚

#### C. è·¨æ¨¡å—é…ç½®ä¾èµ– ("åƒå¤§æˆ·"é—®é¢˜)
*   **é—®é¢˜**ï¼šGateway å’Œ Flight å¯åŠ¨æŠ¥é”™ `Could not resolve placeholder 'app.jwt.secret'`ã€‚
    *   **åŸå› **ï¼šCommon æ¨¡å—çš„ `JwtTokenProvider` éœ€è¦å¯†é’¥ï¼Œä½†å¼•ç”¨å®ƒçš„æœåŠ¡æ²¡æœ‰åœ¨é…ç½®é‡Œæä¾›ã€‚
    *   **è§£å†³**ï¼šåœ¨ Nacos çš„ `gateway-service.yaml` å’Œ `flight-service.yaml` ä¸­**è¿½åŠ  JWT é…ç½®å—**ã€‚

#### D. æŠ€æœ¯æ ˆå†²çª
*   **é—®é¢˜**ï¼šGateway å¼•å…¥ Common åè¢«è¿«å¼•å…¥ JPAï¼Œå¯¼è‡´å¯åŠ¨æ£€æŸ¥æ•°æ®åº“å¤±è´¥ã€‚
    *   **è§£å†³**ï¼šåœ¨ `GatewayApplication` æ³¨è§£ä¸­æ·»åŠ  `exclude = {DataSourceAutoConfiguration.class}`ã€‚

---

### 5. ğŸš¨ å½“å‰ç´§æ€¥ä¿®å¤é¡¹ (Auth Service 500 é”™è¯¯)

æ ¹æ®å¦ä¸€åˆ†æ”¯çš„åé¦ˆï¼Œ**Auth Service ç›®å‰ç™»å½•æŠ¥ 500 é”™è¯¯**ã€‚ç»“åˆä¹‹å‰çš„ç»éªŒï¼Œè¿™ 99% æ˜¯å› ä¸º Auth æœåŠ¡ä¹Ÿå¼•ç”¨äº† Common æ¨¡å—ï¼Œä½† **Nacos é…ç½®ç¼ºå¤±**ã€‚

**ç«‹å³æ‰§è¡Œçš„æ“ä½œ**ï¼š
1.  ç™»å½• Nacosã€‚
2.  æ–°å»º/ç¼–è¾‘ `auth-service.yaml`ã€‚
3.  **å¿…é¡»åŒ…å«ä»¥ä¸‹ä¸‰éƒ¨åˆ†**ï¼š
    *   **æ•°æ®åº“é…ç½®** (è¿æ¥ `planetickets`ï¼ŒåŒ…å« `users` è¡¨)ã€‚
    *   **Redis é…ç½®** (ç”¨äºç¼“å­˜)ã€‚
    *   **JWT é…ç½®** (è‡³å…³é‡è¦ï¼`app.jwt.secret` å’Œ `expiration-ms`)ã€‚

---

### 6. ğŸ“… æ¥ä¸‹æ¥çš„ä»»åŠ¡æ¸…å• (Next Steps)

#### âœ… é˜¶æ®µä¸€ï¼šæ‰“é€šè®¤è¯ (Auth Service) - *è¿›è¡Œä¸­*
*   **ä»»åŠ¡ 1**ï¼šä¿®å¤ Nacos é…ç½®ï¼Œè§£å†³ 500 é”™è¯¯ã€‚
*   **ä»»åŠ¡ 2**ï¼šåœ¨ `AuthServiceImpl` ä¸­å¼•å…¥ `BCryptPasswordEncoder`ï¼Œå®ç°æ³¨å†Œæ—¶å¯†ç åŠ å¯†ï¼Œç™»å½•æ—¶å¯†ç æ¯”å¯¹ã€‚
*   **ä»»åŠ¡ 3**ï¼šæµ‹è¯• "æ³¨å†Œ -> ç™»å½• -> è·å– Token" çš„å®Œæ•´æµç¨‹ã€‚

#### ğŸ”² é˜¶æ®µäºŒï¼šå®Œå–„è®¢å• (Order Service)
*   **ä»»åŠ¡ 1**ï¼šåˆ›å»º `order-service` æ¨¡å—ï¼Œé…ç½® `pom.xml` å’Œ Nacosã€‚
*   **ä»»åŠ¡ 2**ï¼šå®ç° `TicketController` ä¸­çš„ `sold-count` æ¥å£ï¼ˆå“åº” Common ä¸­çš„ Feign è°ƒç”¨ï¼‰ã€‚
*   **ä»»åŠ¡ 3**ï¼šå®ç°ä¸‹å•é€»è¾‘ã€‚
    *   å…ˆé€šè¿‡ Feign é—® Flight æœåŠ¡ï¼šâ€œè¿˜æœ‰ç¥¨å—ï¼Ÿâ€
    *   å¦‚æœæœ‰ï¼Œå†™å…¥ `tickets` è¡¨ï¼Œå¹¶æ‰£å‡ `daily_flight_stock`ï¼ˆéœ€å¤„ç†å¹¶å‘æˆ–åˆ†å¸ƒå¼äº‹åŠ¡ï¼‰ã€‚

#### ğŸ”² é˜¶æ®µä¸‰ï¼šåå°ç®¡ç† (Admin Service)
*   **ä»»åŠ¡ 1**ï¼šåˆ›å»ºæ¨¡å—ã€‚
*   **ä»»åŠ¡ 2**ï¼šå®ç°èšåˆæ¥å£ã€‚è°ƒç”¨ Auth æŸ¥ç”¨æˆ·æ•°ï¼Œè°ƒç”¨ Order æŸ¥é”€å”®é¢ï¼Œç»„è£…æˆ Dashboard æ•°æ®è¿”å›ç»™å‰ç«¯ã€‚

---

**æ€»ç»“è¯­**ï¼š
ç›®å‰çš„è¿›åº¦æ˜¯ **"éª¨æ¶å·²æˆï¼Œè¡€è‚‰å¾…å……"**ã€‚
åŸºç¡€è®¾æ–½ï¼ˆç½‘å…³ã€æ³¨å†Œä¸­å¿ƒã€é…ç½®ä¸­å¿ƒã€å…¬å…±åº“ï¼‰å·²ç»éå¸¸ç¨³å›ºã€‚
æ¥ä¸‹æ¥çš„å·¥ä½œé‡å¿ƒå°†ä»â€œé…ç¯å¢ƒâ€è½¬ç§»åˆ°â€œå†™ä¸šåŠ¡é€»è¾‘ï¼ˆAuth/Orderï¼‰â€ä¸Šã€‚åªè¦è§£å†³äº† Auth çš„é…ç½®é—®é¢˜ï¼Œæ•´ä¸ªç³»ç»Ÿå°±å½»åº•æ´»äº†ã€‚



