{"ast":null,"code":"// 【核心修改】直接引入 axios 和 Message\nimport axios from 'axios';\nimport { Message } from 'element-ui';\nimport { store, mutations } from '@/store';\nexport default {\n  name: 'LoginModal',\n  data() {\n    return {\n      loginForm: {\n        username: '',\n        password: ''\n      },\n      rules: {\n        username: [{\n          required: true,\n          message: '请输入手机号',\n          trigger: 'blur'\n        }],\n        password: [{\n          required: true,\n          message: '请输入密码',\n          trigger: 'blur'\n        }]\n      },\n      isLoading: false,\n      errorMessage: ''\n    };\n  },\n  computed: {\n    showModal() {\n      return store.showLoginModal;\n    }\n  },\n  methods: {\n    closeModal() {\n      mutations.setShowLoginModal(false);\n    },\n    switchToRegister() {\n      mutations.setShowRegisterModal(true);\n    },\n    async handleLogin() {\n      this.$refs.loginForm.validate(async valid => {\n        if (valid) {\n          this.isLoading = true;\n          this.errorMessage = '';\n          try {\n            // 【核心修复】我们在这里创建一个全新的、独立的 Axios 请求\n            // 绕过所有外部可能被污染的实例\n            const response = await axios.post(\n            // 1. 请求 URL\n            'http://localhost:8080/api/auth/login',\n            // 2. 请求体 (Body)\n            {\n              username: this.loginForm.username,\n              password: this.loginForm.password\n            },\n            // 3. 配置对象，强制指定 headers\n            {\n              headers: {\n                'Content-Type': 'application/json'\n              }\n            });\n\n            // 后续逻辑与之前相同\n            const apiResponse = response.data; // axios 返回的 data 是我们 ApiResponse\n            if (apiResponse.code === 200) {\n              const loginData = apiResponse.data;\n              mutations.setUser(loginData, loginData.token);\n              Message.success('登录成功');\n              this.closeModal();\n            } else {\n              // 处理后端返回的业务错误\n              this.errorMessage = apiResponse.message || '登录失败';\n            }\n          } catch (error) {\n            console.error('Login failed in component:', error);\n            if (error.response) {\n              // 处理 HTTP 错误\n              this.errorMessage = error.response.data?.message || `登录失败，错误码: ${error.response.status}`;\n            } else {\n              this.errorMessage = '网络错误，请检查连接';\n            }\n          } finally {\n            this.isLoading = false;\n          }\n        }\n      });\n    }\n  }\n};","map":{"version":3,"names":["axios","Message","store","mutations","name","data","loginForm","username","password","rules","required","message","trigger","isLoading","errorMessage","computed","showModal","showLoginModal","methods","closeModal","setShowLoginModal","switchToRegister","setShowRegisterModal","handleLogin","$refs","validate","valid","response","post","headers","apiResponse","code","loginData","setUser","token","success","error","console","status"],"sources":["src/components/LoginModal.vue"],"sourcesContent":["<template>\n  <div class=\"modal\" v-if=\"showModal\">\n    <div class=\"modal-content\">\n      <div class=\"modal-header\">\n        <h3 class=\"modal-title\">用户登录</h3>\n        <button class=\"close-btn\" @click=\"closeModal\">×</button>\n      </div>\n      <div class=\"modal-body\">\n        <el-form :model=\"loginForm\" :rules=\"rules\" ref=\"loginForm\" @submit.native.prevent=\"handleLogin\">\n          <el-form-item prop=\"username\">\n            <el-input v-model=\"loginForm.username\" placeholder=\"手机号\"></el-input>\n          </el-form-item>\n          <el-form-item prop=\"password\">\n            <el-input type=\"password\" v-model=\"loginForm.password\" placeholder=\"密码\"></el-input>\n          </el-form-item>\n          <el-alert\n            v-if=\"errorMessage\"\n            :title=\"errorMessage\"\n            type=\"error\"\n            show-icon\n            :closable=\"false\"\n            style=\"margin-bottom: 20px;\">\n          </el-alert>\n          <el-form-item>\n            <el-button type=\"primary\" @click=\"handleLogin\" :loading=\"isLoading\" style=\"width: 100%;\">\n              {{ isLoading ? '登录中...' : '登录' }}\n            </el-button>\n          </el-form-item>\n        </el-form>\n        <div class=\"switch-text text-center\">\n          还没有账号？ <a @click=\"switchToRegister\">立即注册</a>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\n// 【核心修改】直接引入 axios 和 Message\nimport axios from 'axios';\nimport { Message } from 'element-ui';\nimport { store, mutations } from '@/store';\n\nexport default {\n  name: 'LoginModal',\n  data() {\n    return {\n      loginForm: {\n        username: '',\n        password: '',\n      },\n      rules: {\n        username: [{ required: true, message: '请输入手机号', trigger: 'blur' }],\n        password: [{ required: true, message: '请输入密码', trigger: 'blur' }],\n      },\n      isLoading: false,\n      errorMessage: '',\n    };\n  },\n  computed: {\n    showModal() {\n      return store.showLoginModal;\n    },\n  },\n  methods: {\n    closeModal() {\n      mutations.setShowLoginModal(false);\n    },\n    switchToRegister() {\n      mutations.setShowRegisterModal(true);\n    },\n    async handleLogin() {\n      this.$refs.loginForm.validate(async (valid) => {\n        if (valid) {\n          this.isLoading = true;\n          this.errorMessage = '';\n          try {\n            // 【核心修复】我们在这里创建一个全新的、独立的 Axios 请求\n            // 绕过所有外部可能被污染的实例\n            const response = await axios.post(\n              // 1. 请求 URL\n              'http://localhost:8080/api/auth/login', \n              // 2. 请求体 (Body)\n              {\n                username: this.loginForm.username,\n                password: this.loginForm.password,\n              },\n              // 3. 配置对象，强制指定 headers\n              {\n                headers: {\n                  'Content-Type': 'application/json'\n                }\n              }\n            );\n\n            // 后续逻辑与之前相同\n            const apiResponse = response.data; // axios 返回的 data 是我们 ApiResponse\n            if (apiResponse.code === 200) {\n              const loginData = apiResponse.data;\n              mutations.setUser(loginData, loginData.token);\n              Message.success('登录成功');\n              this.closeModal();\n            } else {\n              // 处理后端返回的业务错误\n              this.errorMessage = apiResponse.message || '登录失败';\n            }\n\n          } catch (error) {\n            console.error('Login failed in component:', error);\n            if (error.response) {\n              // 处理 HTTP 错误\n              this.errorMessage = error.response.data?.message || `登录失败，错误码: ${error.response.status}`;\n            } else {\n              this.errorMessage = '网络错误，请检查连接';\n            }\n          } finally {\n            this.isLoading = false;\n          }\n        }\n      });\n    },\n  },\n};\n</script>\n\n<style scoped>\n/* 样式保持不变 */\n.modal {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n}\n.modal-content {\n  background: white;\n  border-radius: 8px;\n  width: 100%;\n  max-width: 400px;\n  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n}\n.modal-header {\n  padding: 20px;\n  border-bottom: 1px solid #eee;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n.modal-title {\n  font-size: 20px;\n  font-weight: 600;\n}\n.modal-body {\n  padding: 20px;\n}\n.close-btn {\n  background: none;\n  border: none;\n  font-size: 24px;\n  cursor: pointer;\n  color: #909399;\n}\n.switch-text {\n  margin-top: 15px;\n  font-size: 14px;\n  color: #606266;\n}\n.switch-text a {\n  color: #409eff;\n  cursor: pointer;\n  text-decoration: none;\n}\n.switch-text a:hover {\n  text-decoration: underline;\n}\n.text-center {\n  text-align: center;\n}\n</style>"],"mappings":"AAsCA;AACA,OAAAA,KAAA;AACA,SAAAC,OAAA;AACA,SAAAC,KAAA,EAAAC,SAAA;AAEA;EACAC,IAAA;EACAC,KAAA;IACA;MACAC,SAAA;QACAC,QAAA;QACAC,QAAA;MACA;MACAC,KAAA;QACAF,QAAA;UAAAG,QAAA;UAAAC,OAAA;UAAAC,OAAA;QAAA;QACAJ,QAAA;UAAAE,QAAA;UAAAC,OAAA;UAAAC,OAAA;QAAA;MACA;MACAC,SAAA;MACAC,YAAA;IACA;EACA;EACAC,QAAA;IACAC,UAAA;MACA,OAAAd,KAAA,CAAAe,cAAA;IACA;EACA;EACAC,OAAA;IACAC,WAAA;MACAhB,SAAA,CAAAiB,iBAAA;IACA;IACAC,iBAAA;MACAlB,SAAA,CAAAmB,oBAAA;IACA;IACA,MAAAC,YAAA;MACA,KAAAC,KAAA,CAAAlB,SAAA,CAAAmB,QAAA,OAAAC,KAAA;QACA,IAAAA,KAAA;UACA,KAAAb,SAAA;UACA,KAAAC,YAAA;UACA;YACA;YACA;YACA,MAAAa,QAAA,SAAA3B,KAAA,CAAA4B,IAAA;YACA;YACA;YACA;YACA;cACArB,QAAA,OAAAD,SAAA,CAAAC,QAAA;cACAC,QAAA,OAAAF,SAAA,CAAAE;YACA;YACA;YACA;cACAqB,OAAA;gBACA;cACA;YACA,CACA;;YAEA;YACA,MAAAC,WAAA,GAAAH,QAAA,CAAAtB,IAAA;YACA,IAAAyB,WAAA,CAAAC,IAAA;cACA,MAAAC,SAAA,GAAAF,WAAA,CAAAzB,IAAA;cACAF,SAAA,CAAA8B,OAAA,CAAAD,SAAA,EAAAA,SAAA,CAAAE,KAAA;cACAjC,OAAA,CAAAkC,OAAA;cACA,KAAAhB,UAAA;YACA;cACA;cACA,KAAAL,YAAA,GAAAgB,WAAA,CAAAnB,OAAA;YACA;UAEA,SAAAyB,KAAA;YACAC,OAAA,CAAAD,KAAA,+BAAAA,KAAA;YACA,IAAAA,KAAA,CAAAT,QAAA;cACA;cACA,KAAAb,YAAA,GAAAsB,KAAA,CAAAT,QAAA,CAAAtB,IAAA,EAAAM,OAAA,iBAAAyB,KAAA,CAAAT,QAAA,CAAAW,MAAA;YACA;cACA,KAAAxB,YAAA;YACA;UACA;YACA,KAAAD,SAAA;UACA;QACA;MACA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}