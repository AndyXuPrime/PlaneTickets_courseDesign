{"ast":null,"code":"import api from '@/api';\nimport { store, mutations } from '@/store';\nexport default {\n  name: 'RegisterModal',\n  data() {\n    return {\n      form: {\n        name: '',\n        phone: '',\n        password: '',\n        idCard: '',\n        email: '',\n        membershipLevel: '普通' // 默认值\n      },\n      rules: {\n        // 表单验证规则\n        name: [{\n          required: true,\n          message: '姓名不能为空',\n          trigger: 'blur'\n        }],\n        phone: [{\n          required: true,\n          message: '手机号不能为空',\n          trigger: 'blur'\n        }, {\n          pattern: /^1[3-9]\\d{9}$/,\n          message: '手机号格式不正确',\n          trigger: 'blur'\n        }],\n        password: [{\n          required: true,\n          message: '密码不能为空',\n          trigger: 'blur'\n        }, {\n          min: 6,\n          message: '密码长度至少为6位',\n          trigger: 'blur'\n        }],\n        idCard: [{\n          required: true,\n          message: '身份证号不能为空',\n          trigger: 'blur'\n        }, {\n          len: 18,\n          message: '身份证号必须为18位',\n          trigger: 'blur'\n        }],\n        membershipLevel: [{\n          required: true,\n          message: '请选择会员等级',\n          trigger: 'change'\n        }]\n      },\n      isLoading: false,\n      // 【核心修改 2】增加一个用于存储错误信息的变量\n      errorMessage: ''\n    };\n  },\n  computed: {\n    showModal: {\n      get() {\n        return store.showRegisterModal;\n      },\n      set(value) {\n        mutations.setShowRegisterModal(value);\n      }\n    }\n  },\n  methods: {\n    handleRegister() {\n      this.$refs.registerForm.validate(async valid => {\n        if (valid) {\n          this.isLoading = true;\n          this.errorMessage = ''; // 开始注册前，清空旧的错误信息\n          try {\n            await api.register(this.form);\n            this.$message.success('注册成功！现在您可以登录了。');\n            this.switchToLogin(); // 注册成功后，自动切换到登录弹窗\n          } catch (error) {\n            // 【核心修改 3】捕获错误，并从后端返回的响应中提取 message\n            if (error.response && error.response.data && error.response.data.message) {\n              this.errorMessage = error.response.data.message;\n            } else {\n              this.errorMessage = '发生未知错误，请稍后重试。';\n            }\n            console.error('注册时出错:', error);\n          } finally {\n            this.isLoading = false;\n          }\n        }\n      });\n    },\n    switchToLogin() {\n      mutations.setShowLoginModal(true);\n    },\n    close() {\n      this.$refs.registerForm.resetFields();\n      this.errorMessage = ''; // 关闭弹窗时也清空错误信息\n      mutations.setShowRegisterModal(false);\n    }\n  }\n};","map":{"version":3,"names":["api","store","mutations","name","data","form","phone","password","idCard","email","membershipLevel","rules","required","message","trigger","pattern","min","len","isLoading","errorMessage","computed","showModal","get","showRegisterModal","set","value","setShowRegisterModal","methods","handleRegister","$refs","registerForm","validate","valid","register","$message","success","switchToLogin","error","response","console","setShowLoginModal","close","resetFields"],"sources":["src/components/RegisterModal.vue"],"sourcesContent":["<template>\n  <el-dialog\n    title=\"新用户注册\"\n    :visible.sync=\"showModal\"\n    width=\"400px\"\n    @close=\"close\"\n    :close-on-click-modal=\"false\"\n  >\n    <el-form :model=\"form\" :rules=\"rules\" ref=\"registerForm\" label-position=\"top\">\n      \n      <!-- 【核心修改 1】在这里添加错误提示区域 -->\n      <el-alert\n        v-if=\"errorMessage\"\n        :title=\"errorMessage\"\n        type=\"error\"\n        show-icon\n        class=\"error-alert\"\n        @close=\"errorMessage = ''\"\n      ></el-alert>\n\n      <el-form-item label=\"姓名\" prop=\"name\">\n        <el-input v-model=\"form.name\" placeholder=\"请输入您的真实姓名\"></el-input>\n      </el-form-item>\n      <el-form-item label=\"手机号\" prop=\"phone\">\n        <el-input v-model=\"form.phone\" placeholder=\"请输入您的手机号\"></el-input>\n      </el-form-item>\n      <el-form-item label=\"密码 (至少6位)\" prop=\"password\">\n        <el-input v-model=\"form.password\" type=\"password\" placeholder=\"请输入密码\"></el-input>\n      </el-form-item>\n      <el-form-item label=\"身份证号\" prop=\"idCard\">\n        <el-input v-model=\"form.idCard\" placeholder=\"请输入18位身份证号\"></el-input>\n      </el-form-item>\n      <el-form-item label=\"邮箱 (可选)\" prop=\"email\">\n        <el-input v-model=\"form.email\" placeholder=\"请输入您的电子邮箱\"></el-input>\n      </el-form-item>\n      <el-form-item label=\"选择会员等级\" prop=\"membershipLevel\">\n        <el-select v-model=\"form.membershipLevel\" placeholder=\"请选择\" style=\"width: 100%;\">\n          <el-option label=\"普通会员\" value=\"普通\"></el-option>\n          <el-option label=\"银卡会员\" value=\"银卡\"></el-option>\n          <el-option label=\"金卡会员\" value=\"金卡\"></el-option>\n          <el-option label=\"白金会员\" value=\"白金\"></el-option>\n        </el-select>\n      </el-form-item>\n    </el-form>\n    <span slot=\"footer\" class=\"dialog-footer\">\n      <el-button \n        type=\"primary\" \n        @click=\"handleRegister\" \n        :loading=\"isLoading\" \n        style=\"width: 100%;\"\n      >\n        {{ isLoading ? '注册中...' : '同意协议并注册' }}\n      </el-button>\n      <div class=\"switch-login\">\n        已有账号？ <el-link type=\"primary\" @click=\"switchToLogin\">立即登录</el-link>\n      </div>\n    </span>\n  </el-dialog>\n</template>\n\n<script>\nimport api from '@/api';\nimport { store, mutations } from '@/store';\n\nexport default {\n  name: 'RegisterModal',\n  data() {\n    return {\n      form: {\n        name: '',\n        phone: '',\n        password: '',\n        idCard: '',\n        email: '',\n        membershipLevel: '普通', // 默认值\n      },\n      rules: {\n        // 表单验证规则\n        name: [{ required: true, message: '姓名不能为空', trigger: 'blur' }],\n        phone: [\n          { required: true, message: '手机号不能为空', trigger: 'blur' },\n          { pattern: /^1[3-9]\\d{9}$/, message: '手机号格式不正确', trigger: 'blur' }\n        ],\n        password: [\n          { required: true, message: '密码不能为空', trigger: 'blur' },\n          { min: 6, message: '密码长度至少为6位', trigger: 'blur' }\n        ],\n        idCard: [\n          { required: true, message: '身份证号不能为空', trigger: 'blur' },\n          { len: 18, message: '身份证号必须为18位', trigger: 'blur' }\n        ],\n        membershipLevel: [{ required: true, message: '请选择会员等级', trigger: 'change' }],\n      },\n      isLoading: false,\n      // 【核心修改 2】增加一个用于存储错误信息的变量\n      errorMessage: '', \n    };\n  },\n  computed: {\n    showModal: {\n      get() {\n        return store.showRegisterModal;\n      },\n      set(value) {\n        mutations.setShowRegisterModal(value);\n      }\n    }\n  },\n  methods: {\n    handleRegister() {\n      this.$refs.registerForm.validate(async (valid) => {\n        if (valid) {\n          this.isLoading = true;\n          this.errorMessage = ''; // 开始注册前，清空旧的错误信息\n          try {\n            await api.register(this.form);\n            this.$message.success('注册成功！现在您可以登录了。');\n            this.switchToLogin(); // 注册成功后，自动切换到登录弹窗\n          } catch (error) {\n            // 【核心修改 3】捕获错误，并从后端返回的响应中提取 message\n            if (error.response && error.response.data && error.response.data.message) {\n              this.errorMessage = error.response.data.message;\n            } else {\n              this.errorMessage = '发生未知错误，请稍后重试。';\n            }\n            console.error('注册时出错:', error);\n          } finally {\n            this.isLoading = false;\n          }\n        }\n      });\n    },\n    switchToLogin() {\n      mutations.setShowLoginModal(true);\n    },\n    close() {\n      this.$refs.registerForm.resetFields();\n      this.errorMessage = ''; // 关闭弹窗时也清空错误信息\n      mutations.setShowRegisterModal(false);\n    }\n  }\n};\n</script>\n\n<style scoped>\n/* 所有样式均与您提供的版本保持一致 */\n/* --- 通用模态框样式 --- */\n.modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:1000}\n.modal-content-styled{position:relative;background-color:#fff;padding:25px 35px;border-radius:16px;box-shadow:0 5px 20px rgba(0,0,0,.1);width:500px}\n.heading{font-size:24px;font-weight:600;text-align:center;margin-bottom:25px;color:#333}\n.close-button{position:absolute;top:15px;right:15px;background:none;border:none;font-size:24px;cursor:pointer;color:#aaa;transition:color .2s}\n.close-button:hover{color:#333}\n/* --- 表单样式 --- */\n.form{display:flex;flex-direction:column;gap:20px}\n.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px}\n.input-field{position:relative}\n.input-field label{position:absolute;color:#007bff;pointer-events:none;background-color:#fff;padding:0 4px;left:12px;top:-10px;font-size:14px;transition:all .2s ease-in-out}\n.input-field input{padding:12px 15px;font-size:16px;border-radius:8px;border:1px solid #ced4da;width:100%;box-sizing:border-box;transition:border-color .2s}\n.input-field input:focus{outline:none;border-color:#007bff}\n.form .passicon{cursor:pointer;font-size:1.2rem;position:absolute;top:50%;transform:translateY(-50%);right:12px;color:#8d8d8d}\n/* --- 会员等级选择 --- */\n.membership-selection{margin-top:10px}\n.group-label{display:block;margin-bottom:10px;font-weight:500;color:#555;font-size:14px}\n.options-container{display:grid;grid-template-columns:1fr 1fr;gap:15px}\n.option-card{position:relative;border:1px solid #ced4da;border-radius:8px;padding:15px;text-align:center;cursor:pointer;transition:all .2s ease-in-out}\n.option-card:hover{border-color:#89bdf7}\n.option-card.selected{border-color:#007bff;background-color:#e7f3ff;box-shadow:0 0 0 2px #007bff}\n.level-name{font-weight:600;color:#333;font-size:16px}\n.level-desc{font-size:13px;color:#888;margin-top:5px}\n.option-card.selected::after{content:'';position:absolute;bottom:-1px;right:20px;width:16px;height:16px;background-color:#007bff;border-radius:50%;border:3px solid #fff;transform:translateY(50%)}\n/* --- 提交按钮 --- */\n.btn-container{margin-top:10px}\n.btn-submit{width:100%;padding:14px 20px;font-size:16px;border-radius:50px;border:none;background:linear-gradient(135deg,#006eff,#0034de);color:#fff;font-weight:700;cursor:pointer;transition:all .3s ease}\n.btn-submit:hover{opacity:.9;box-shadow:0 4px 15px rgba(0,110,255,.3)}\n.btn-submit:disabled{opacity:.6;cursor:not-allowed}\n/* --- 切换链接 --- */\n.switch-text{margin-top:20px;color:var(--gray);font-size:14px}\n.switch-text a{color:var(--primary);cursor:pointer;text-decoration:none;font-weight:500}\n.text-center{text-align:center}\n.switch-login {\n  text-align: center;\n  margin-top: 15px;\n}\n.error-alert {\n  margin-bottom: 20px;\n}\n</style>"],"mappings":"AA6DA,OAAAA,GAAA;AACA,SAAAC,KAAA,EAAAC,SAAA;AAEA;EACAC,IAAA;EACAC,KAAA;IACA;MACAC,IAAA;QACAF,IAAA;QACAG,KAAA;QACAC,QAAA;QACAC,MAAA;QACAC,KAAA;QACAC,eAAA;MACA;MACAC,KAAA;QACA;QACAR,IAAA;UAAAS,QAAA;UAAAC,OAAA;UAAAC,OAAA;QAAA;QACAR,KAAA,GACA;UAAAM,QAAA;UAAAC,OAAA;UAAAC,OAAA;QAAA,GACA;UAAAC,OAAA;UAAAF,OAAA;UAAAC,OAAA;QAAA,EACA;QACAP,QAAA,GACA;UAAAK,QAAA;UAAAC,OAAA;UAAAC,OAAA;QAAA,GACA;UAAAE,GAAA;UAAAH,OAAA;UAAAC,OAAA;QAAA,EACA;QACAN,MAAA,GACA;UAAAI,QAAA;UAAAC,OAAA;UAAAC,OAAA;QAAA,GACA;UAAAG,GAAA;UAAAJ,OAAA;UAAAC,OAAA;QAAA,EACA;QACAJ,eAAA;UAAAE,QAAA;UAAAC,OAAA;UAAAC,OAAA;QAAA;MACA;MACAI,SAAA;MACA;MACAC,YAAA;IACA;EACA;EACAC,QAAA;IACAC,SAAA;MACAC,IAAA;QACA,OAAArB,KAAA,CAAAsB,iBAAA;MACA;MACAC,IAAAC,KAAA;QACAvB,SAAA,CAAAwB,oBAAA,CAAAD,KAAA;MACA;IACA;EACA;EACAE,OAAA;IACAC,eAAA;MACA,KAAAC,KAAA,CAAAC,YAAA,CAAAC,QAAA,OAAAC,KAAA;QACA,IAAAA,KAAA;UACA,KAAAd,SAAA;UACA,KAAAC,YAAA;UACA;YACA,MAAAnB,GAAA,CAAAiC,QAAA,MAAA5B,IAAA;YACA,KAAA6B,QAAA,CAAAC,OAAA;YACA,KAAAC,aAAA;UACA,SAAAC,KAAA;YACA;YACA,IAAAA,KAAA,CAAAC,QAAA,IAAAD,KAAA,CAAAC,QAAA,CAAAlC,IAAA,IAAAiC,KAAA,CAAAC,QAAA,CAAAlC,IAAA,CAAAS,OAAA;cACA,KAAAM,YAAA,GAAAkB,KAAA,CAAAC,QAAA,CAAAlC,IAAA,CAAAS,OAAA;YACA;cACA,KAAAM,YAAA;YACA;YACAoB,OAAA,CAAAF,KAAA,WAAAA,KAAA;UACA;YACA,KAAAnB,SAAA;UACA;QACA;MACA;IACA;IACAkB,cAAA;MACAlC,SAAA,CAAAsC,iBAAA;IACA;IACAC,MAAA;MACA,KAAAZ,KAAA,CAAAC,YAAA,CAAAY,WAAA;MACA,KAAAvB,YAAA;MACAjB,SAAA,CAAAwB,oBAAA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}