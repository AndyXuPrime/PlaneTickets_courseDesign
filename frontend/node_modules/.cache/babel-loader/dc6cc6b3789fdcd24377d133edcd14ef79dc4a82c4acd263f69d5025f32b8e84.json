{"ast":null,"code":"import Vue from 'vue';\nexport const store = Vue.observable({\n  isLoggedIn: false,\n  user: null,\n  // 用于存储 { customerId, username, name, membershipLevel 等 }\n  showLoginModal: false,\n  showRegisterModal: false\n});\nexport const mutations = {\n  // 【核心修复】确保 setUser 接收的是完整的 user 对象\n  setUser(user, token) {\n    store.isLoggedIn = true;\n    // user 对象现在应该直接包含 { token, username, customerId, ... }\n    // 我们直接把它存起来\n    store.user = user;\n\n    // 分别存储 token 和 user 对象\n    localStorage.setItem('authToken', token);\n    localStorage.setItem('user', JSON.stringify(user));\n    console.log('User set in store:', store.user); // 增加调试日志\n  },\n  clearUser() {\n    store.isLoggedIn = false;\n    store.user = null;\n    localStorage.removeItem('authToken');\n    localStorage.removeItem('user');\n    console.log('User cleared from store.'); // 增加调试日志\n  },\n  setShowLoginModal(value) {\n    if (value) store.showRegisterModal = false;\n    store.showLoginModal = value;\n  },\n  setShowRegisterModal(value) {\n    if (value) store.showLoginModal = false;\n    store.showRegisterModal = value;\n  },\n  // 【核心修复】确保从 localStorage 加载时，user 是一个完整的对象\n  loadUserFromStorage() {\n    const token = localStorage.getItem('authToken');\n    const userJson = localStorage.getItem('user');\n    if (token && userJson) {\n      try {\n        const user = JSON.parse(userJson);\n        store.isLoggedIn = true;\n        store.user = user;\n        console.log('User loaded from storage:', store.user); // 增加调试日志\n      } catch (e) {\n        console.error(\"Failed to parse user from localStorage\", e);\n        this.clearUser();\n      }\n    }\n  }\n};","map":{"version":3,"names":["Vue","store","observable","isLoggedIn","user","showLoginModal","showRegisterModal","mutations","setUser","token","localStorage","setItem","JSON","stringify","console","log","clearUser","removeItem","setShowLoginModal","value","setShowRegisterModal","loadUserFromStorage","getItem","userJson","parse","e","error"],"sources":["D:/LearnSomeComputerPrograms VSCode/AndyJava/PlaneTickets_courseDesign-main/frontend/src/store/index.js"],"sourcesContent":["import Vue from 'vue';\n\nexport const store = Vue.observable({\n    isLoggedIn: false,\n    user: null, // 用于存储 { customerId, username, name, membershipLevel 等 }\n    showLoginModal: false,\n    showRegisterModal: false,\n});\n\nexport const mutations = {\n    // 【核心修复】确保 setUser 接收的是完整的 user 对象\n    setUser(user, token) {\n        store.isLoggedIn = true;\n        // user 对象现在应该直接包含 { token, username, customerId, ... }\n        // 我们直接把它存起来\n        store.user = user;\n\n        // 分别存储 token 和 user 对象\n        localStorage.setItem('authToken', token);\n        localStorage.setItem('user', JSON.stringify(user));\n\n        console.log('User set in store:', store.user); // 增加调试日志\n    },\n    clearUser() {\n        store.isLoggedIn = false;\n        store.user = null;\n        localStorage.removeItem('authToken');\n        localStorage.removeItem('user');\n        console.log('User cleared from store.'); // 增加调试日志\n    },\n    setShowLoginModal(value) {\n        if (value) store.showRegisterModal = false;\n        store.showLoginModal = value;\n    },\n    setShowRegisterModal(value) {\n        if (value) store.showLoginModal = false;\n        store.showRegisterModal = value;\n    },\n    // 【核心修复】确保从 localStorage 加载时，user 是一个完整的对象\n    loadUserFromStorage() {\n        const token = localStorage.getItem('authToken');\n        const userJson = localStorage.getItem('user');\n        if (token && userJson) {\n            try {\n                const user = JSON.parse(userJson);\n                store.isLoggedIn = true;\n                store.user = user;\n                console.log('User loaded from storage:', store.user); // 增加调试日志\n            } catch (e) {\n                console.error(\"Failed to parse user from localStorage\", e);\n                this.clearUser();\n            }\n        }\n    }\n};"],"mappings":"AAAA,OAAOA,GAAG,MAAM,KAAK;AAErB,OAAO,MAAMC,KAAK,GAAGD,GAAG,CAACE,UAAU,CAAC;EAChCC,UAAU,EAAE,KAAK;EACjBC,IAAI,EAAE,IAAI;EAAE;EACZC,cAAc,EAAE,KAAK;EACrBC,iBAAiB,EAAE;AACvB,CAAC,CAAC;AAEF,OAAO,MAAMC,SAAS,GAAG;EACrB;EACAC,OAAOA,CAACJ,IAAI,EAAEK,KAAK,EAAE;IACjBR,KAAK,CAACE,UAAU,GAAG,IAAI;IACvB;IACA;IACAF,KAAK,CAACG,IAAI,GAAGA,IAAI;;IAEjB;IACAM,YAAY,CAACC,OAAO,CAAC,WAAW,EAAEF,KAAK,CAAC;IACxCC,YAAY,CAACC,OAAO,CAAC,MAAM,EAAEC,IAAI,CAACC,SAAS,CAACT,IAAI,CAAC,CAAC;IAElDU,OAAO,CAACC,GAAG,CAAC,oBAAoB,EAAEd,KAAK,CAACG,IAAI,CAAC,CAAC,CAAC;EACnD,CAAC;EACDY,SAASA,CAAA,EAAG;IACRf,KAAK,CAACE,UAAU,GAAG,KAAK;IACxBF,KAAK,CAACG,IAAI,GAAG,IAAI;IACjBM,YAAY,CAACO,UAAU,CAAC,WAAW,CAAC;IACpCP,YAAY,CAACO,UAAU,CAAC,MAAM,CAAC;IAC/BH,OAAO,CAACC,GAAG,CAAC,0BAA0B,CAAC,CAAC,CAAC;EAC7C,CAAC;EACDG,iBAAiBA,CAACC,KAAK,EAAE;IACrB,IAAIA,KAAK,EAAElB,KAAK,CAACK,iBAAiB,GAAG,KAAK;IAC1CL,KAAK,CAACI,cAAc,GAAGc,KAAK;EAChC,CAAC;EACDC,oBAAoBA,CAACD,KAAK,EAAE;IACxB,IAAIA,KAAK,EAAElB,KAAK,CAACI,cAAc,GAAG,KAAK;IACvCJ,KAAK,CAACK,iBAAiB,GAAGa,KAAK;EACnC,CAAC;EACD;EACAE,mBAAmBA,CAAA,EAAG;IAClB,MAAMZ,KAAK,GAAGC,YAAY,CAACY,OAAO,CAAC,WAAW,CAAC;IAC/C,MAAMC,QAAQ,GAAGb,YAAY,CAACY,OAAO,CAAC,MAAM,CAAC;IAC7C,IAAIb,KAAK,IAAIc,QAAQ,EAAE;MACnB,IAAI;QACA,MAAMnB,IAAI,GAAGQ,IAAI,CAACY,KAAK,CAACD,QAAQ,CAAC;QACjCtB,KAAK,CAACE,UAAU,GAAG,IAAI;QACvBF,KAAK,CAACG,IAAI,GAAGA,IAAI;QACjBU,OAAO,CAACC,GAAG,CAAC,2BAA2B,EAAEd,KAAK,CAACG,IAAI,CAAC,CAAC,CAAC;MAC1D,CAAC,CAAC,OAAOqB,CAAC,EAAE;QACRX,OAAO,CAACY,KAAK,CAAC,wCAAwC,EAAED,CAAC,CAAC;QAC1D,IAAI,CAACT,SAAS,CAAC,CAAC;MACpB;IACJ;EACJ;AACJ,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}