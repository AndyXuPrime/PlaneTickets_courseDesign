{"ast":null,"code":"import api from '@/api';\nimport { store } from '@/store';\nexport default {\n  name: 'BookingView',\n  data() {\n    return {\n      flight: null,\n      selectedCabinClass: '经济舱',\n      isSubmitting: false,\n      selectedDate: '',\n      pickerOptions: {\n        disabledDate(time) {\n          const today = new Date();\n          today.setHours(0, 0, 0, 0);\n          const oneMonthLater = new Date();\n          oneMonthLater.setDate(oneMonthLater.getDate() + 30);\n          return time.getTime() < today.getTime() || time.getTime() > oneMonthLater.getTime();\n        }\n      }\n    };\n  },\n  computed: {\n    currentUser() {\n      return store.user;\n    },\n    basePrice() {\n      if (!this.flight) return 0;\n      return this.flight.price || 0;\n    },\n    membershipDiscountRate() {\n      if (!this.currentUser || !this.currentUser.membershipLevel) return 1.0;\n      switch (this.currentUser.membershipLevel) {\n        case '白金':\n          return 0.85;\n        case '金卡':\n          return 0.90;\n        case '银卡':\n          return 0.95;\n        default:\n          return 1.0;\n      }\n    },\n    finalPrice() {\n      return this.basePrice * this.membershipDiscountRate;\n    }\n  },\n  methods: {\n    async handleSubmitBooking() {\n      if (!this.selectedDate) {\n        this.$message.error('请选择航班日期！');\n        return;\n      }\n      this.isSubmitting = true;\n      try {\n        const bookingRequest = {\n          flightNumber: this.flight.flightNumber,\n          flightDate: this.selectedDate,\n          passengerIds: [this.currentUser.id],\n          cabinClass: this.selectedCabinClass\n        };\n        console.log(bookingRequest);\n        const response = await api.createBooking(bookingRequest);\n        if (response.code === 200) {\n          this.$message.success('预订成功！您的机票状态为“已支付”。即将跳转到我的订单页面。');\n          setTimeout(() => {\n            this.$router.push({\n              name: 'MyOrders'\n            });\n          }, 2000);\n        }\n      } catch (error) {\n        const errorMessage = error.response?.data?.message || '预订失败，可能是余票不足，请稍后重试。';\n        this.$message.error(errorMessage);\n      } finally {\n        this.isSubmitting = false;\n      }\n    }\n  },\n  created() {\n    const flightData = this.$route.query.flight;\n    if (flightData) {\n      try {\n        this.flight = JSON.parse(flightData);\n        this.selectedDate = this.$route.query.date || '';\n        const defaultCabin = this.flight.cabinClassForDisplay;\n        if (defaultCabin === '经济舱' && this.flight.economyRemainingSeats > 0) {\n          this.selectedCabinClass = '经济舱';\n        } else if (defaultCabin === '商务舱' && this.flight.businessRemainingSeats > 0) {\n          this.selectedCabinClass = '商务舱';\n        } else if (this.flight.economyRemainingSeats > 0) {\n          this.selectedCabinClass = '经济舱';\n        } else if (this.flight.businessRemainingSeats > 0) {\n          this.selectedCabinClass = '商务舱';\n        }\n      } catch (e) {\n        this.$message.error('航班信息格式错误，请返回重试。');\n        this.$router.push('/');\n      }\n    } else {\n      this.$message.error('无法获取航班信息，请返回首页重新搜索。');\n      this.$router.push('/');\n    }\n  }\n};","map":{"version":3,"names":["api","store","name","data","flight","selectedCabinClass","isSubmitting","selectedDate","pickerOptions","disabledDate","time","today","Date","setHours","oneMonthLater","setDate","getDate","getTime","computed","currentUser","user","basePrice","price","membershipDiscountRate","membershipLevel","finalPrice","methods","handleSubmitBooking","$message","error","bookingRequest","flightNumber","flightDate","passengerIds","id","cabinClass","console","log","response","createBooking","code","success","setTimeout","$router","push","errorMessage","message","created","flightData","$route","query","JSON","parse","date","defaultCabin","cabinClassForDisplay","economyRemainingSeats","businessRemainingSeats","e"],"sources":["src/views/BookingView.vue"],"sourcesContent":["<template>\n  <div class=\"booking-page\">\n    <div class=\"booking-card\">\n      <div class=\"card-title\">订单确认</div>\n\n      <div class=\"card-content\" v-if=\"flight\">\n        \n        <div class=\"step\">\n          <div class=\"flight-route\">\n            <div class=\"airline\">\n              <i class=\"el-icon-s-promotion\"></i>\n              {{ flight.airlineName }} {{ flight.flightNumber }}\n            </div>\n            \n            <div class=\"price\">¥{{ flight.price.toFixed(2) }}</div>\n          </div>\n          <div class=\"flight-details\">\n            <div class=\"time-place\">\n              <span class=\"time\">{{ flight.departureTime }}</span>\n              <span class=\"place\">{{ flight.departureAirport }}</span>\n            </div>\n            <div class=\"arrow-container\"><div class=\"arrow\"></div></div>\n            <div class=\"time-place\">\n              <span class=\"time\">{{ flight.arrivalTime }}</span>\n              <span class=\"place\">{{ flight.arrivalAirport }}</span>\n            </div>\n          </div>\n        </div>\n\n      \n        <div class=\"step\">\n          <el-form label-position=\"top\" class=\"booking-form\">\n            <el-row :gutter=\"20\">\n              <el-col :span=\"12\">\n                <el-form-item label=\"乘机人\">\n                  <el-input :value=\"currentUser ? currentUser.name : '请先登录'\" disabled></el-input>\n                </el-form-item>\n              </el-col>\n              <el-col :span=\"12\">\n                <el-form-item label=\"选择航班日期\">\n                  <el-date-picker\n                    v-model=\"selectedDate\"\n                    type=\"date\"\n                    placeholder=\"请选择日期\"\n                    format=\"yyyy-MM-dd\"\n                    value-format=\"yyyy-MM-dd\"\n                    :picker-options=\"pickerOptions\"\n                    style=\"width: 100%;\"\n                  >\n                  </el-date-picker>\n                </el-form-item>\n              </el-col>\n            </el-row>\n            <el-form-item label=\"舱位\">\n              <el-radio-group v-model=\"selectedCabinClass\">\n                <el-radio-button label=\"经济舱\" :disabled=\"flight.economyRemainingSeats <= 0\">\n                  经济舱\n                </el-radio-button>\n                <el-radio-button label=\"商务舱\" :disabled=\"flight.businessRemainingSeats <= 0\">\n                  商务舱\n                </el-radio-button>\n              </el-radio-group>\n            </el-form-item>\n          </el-form>\n        </div>\n\n\n      \n        <div class=\"step payments-details\">\n          <div class=\"detail-row\">\n            <span>机票原价</span>\n            <span>¥{{ flight.price.toFixed(2) }}</span>\n          </div>\n          <div class=\"detail-row\" v-if=\"currentUser && membershipDiscountRate < 1.0\">\n            <span>会员折扣 ({{ (1 - membershipDiscountRate).toFixed(2) * 100 }}%)</span>\n            <span class=\"discount-price\">- ¥{{ (flight.price * (1 - membershipDiscountRate)).toFixed(2) }}</span>\n          </div>\n        </div>\n      </div>\n      \n      <div class=\"card-content\" v-else>\n        <p>正在加载航班信息...</p>\n      </div>\n\n      \n      <div class=\"card-footer\">\n        <div class=\"total-price\">\n          <span>总计</span>\n          \n          <strong>¥{{ finalPrice.toFixed(2) }}</strong>\n        </div>\n        <el-button\n          type=\"primary\"\n          class=\"checkout-btn\"\n          @click=\"handleSubmitBooking\"\n          :loading=\"isSubmitting\"\n        >\n          {{ isSubmitting ? '提交中...' : '确认并预订' }}\n        </el-button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport api from '@/api';\nimport { store } from '@/store';\n\nexport default {\n  name: 'BookingView',\n  data() {\n    return {\n      flight: null,\n      selectedCabinClass: '经济舱',\n      isSubmitting: false,\n      selectedDate: '',\n      pickerOptions: {\n        disabledDate(time) {\n          const today = new Date();\n          today.setHours(0, 0, 0, 0);\n          const oneMonthLater = new Date();\n          oneMonthLater.setDate(oneMonthLater.getDate() + 30);\n          return time.getTime() < today.getTime() || time.getTime() > oneMonthLater.getTime();\n        },\n      },\n    };\n  },\n  computed: {\n    currentUser() {\n      return store.user;\n    },\n    \n    basePrice() {\n      if (!this.flight) return 0;\n      return this.flight.price || 0;\n    },\n    membershipDiscountRate() {\n      if (!this.currentUser || !this.currentUser.membershipLevel) return 1.0;\n      switch (this.currentUser.membershipLevel) {\n        case '白金': return 0.85;\n        case '金卡': return 0.90;\n        case '银卡': return 0.95;\n        default: return 1.0;\n      }\n    },\n    \n    finalPrice() {\n      return this.basePrice * this.membershipDiscountRate;\n    },\n  },\n  methods: {\n    async handleSubmitBooking() {\n      \n      if (!this.selectedDate) {\n        this.$message.error('请选择航班日期！');\n        return;\n      }\n\n      this.isSubmitting = true;\n      try {\n        const bookingRequest = {\n          flightNumber: this.flight.flightNumber,\n          flightDate: this.selectedDate,\n          passengerIds: [this.currentUser.id],\n          cabinClass: this.selectedCabinClass,\n        \n        };\n\n        console.log(bookingRequest);\n        const response = await api.createBooking(bookingRequest);\n\n        if (response.code === 200) {\n          this.$message.success('预订成功！您的机票状态为“已支付”。即将跳转到我的订单页面。');\n          setTimeout(() => {\n            this.$router.push({ name: 'MyOrders' });\n          }, 2000);\n        }\n      } catch (error) {\n        const errorMessage = error.response?.data?.message || '预订失败，可能是余票不足，请稍后重试。';\n        this.$message.error(errorMessage);\n      } finally {\n        this.isSubmitting = false;\n      }\n    },\n  },\n  created() {\n    const flightData = this.$route.query.flight;\n    if (flightData) {\n      try {\n        this.flight = JSON.parse(flightData);\n        this.selectedDate = this.$route.query.date || '';\n        \n        \n        const defaultCabin = this.flight.cabinClassForDisplay;\n        if (defaultCabin === '经济舱' && this.flight.economyRemainingSeats > 0) {\n          this.selectedCabinClass = '经济舱';\n        } else if (defaultCabin === '商务舱' && this.flight.businessRemainingSeats > 0) {\n          this.selectedCabinClass = '商务舱';\n        } else if (this.flight.economyRemainingSeats > 0) {\n          this.selectedCabinClass = '经济舱';\n        } else if (this.flight.businessRemainingSeats > 0) {\n          this.selectedCabinClass = '商务舱';\n        }\n      } catch (e) {\n        this.$message.error('航班信息格式错误，请返回重试。');\n        this.$router.push('/');\n      }\n    } else {\n        this.$message.error('无法获取航班信息，请返回首页重新搜索。');\n        this.$router.push('/');\n    }\n  },\n};\n</script>\n\n<style scoped>\n.booking-page {\n  display: flex;\n  justify-content: center;\n  align-items: flex-start;\n  min-height: calc(100vh - 80px);\n  padding: 40px 20px;\n  background-color: #e9f7fa;\n  box-sizing: border-box;\n}\n.booking-card {\n  width: 100%;\n  max-width: 600px;\n  background: #e4fbfd;\n  border-radius: 12px;\n  box-shadow: 0 10px 30px rgba(0, 84, 166, 0.1);\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n}\n.card-title {\n  padding: 15px 20px;\n  font-weight: 600;\n  font-size: 18px;\n  color: #303133;\n  border-bottom: 1px solid #eef5fc;\n  background-color: #f9fcff;\n}\n.card-content {\n  padding: 20px;\n}\n.step {\n  margin-bottom: 25px;\n  border-bottom: 1px solid #123050;\n  padding-bottom: 25px;\n}\n.step:last-child {\n  margin-bottom: 0;\n  border-bottom: none;\n  padding-bottom: 0;\n}\n.flight-route {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 15px;\n}\n.airline {\n  font-weight: 500;\n  color: #0d47a1;\n  display: flex;\n  align-items: center;\n}\n.airline i {\n  margin-right: 8px;\n  font-size: 18px;\n}\n.price {\n  font-size: 20px;\n  font-weight: bold;\n  color: #195faa;\n}\n.flight-details {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n}\n.time-place {\n  display: flex;\n  flex-direction: column;\n  text-align: center;\n}\n.time-place .time {\n  font-size: 24px;\n  font-weight: 500;\n  color: #303133;\n}\n.time-place .place {\n  font-size: 14px;\n  color: #606266;\n  margin-top: 5px;\n}\n.arrow-container {\n  flex-grow: 1;\n  padding: 0 20px;\n}\n.arrow {\n  width: 100%;\n  height: 2px;\n  background-color: #072746;\n  position: relative;\n}\n.arrow::after {\n  content: '';\n  position: absolute;\n  right: -2px;\n  top: -4px;\n  border: solid #072746;\n  border-width: 0 2px 2px 0;\n  display: inline-block;\n  padding: 4px;\n  transform: rotate(-45deg);\n}\n.booking-form .el-form-item {\n  margin-bottom: 15px;\n}\n::v-deep .el-form-item__label {\n  font-weight: 500 !important;\n  color: #303133;\n  padding-bottom: 5px !important;\n}\n::v-deep .el-form-item .el-input.is-disabled .el-input__inner {\n  font-size: 25px;      \n  font-weight: 750;     \n  color: #042c67;       \n  background-color: #daeef0; \n  border-color: #d3e7fa;\n}\n.payments-details .detail-row {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  font-size: 14px;\n  color: #606266;\n  padding: 8px 0;\n}\n.detail-row .discount-price {\n  color: #67c23a; \n  font-weight: 500;\n}\n.card-footer {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 15px 20px;\n  background-color: #cfe5fa;\n  border-top: 1px solid #133c65;\n}\n.total-price {\n  color: #606266;\n}\n.total-price strong {\n  font-size: 24px;\n  color: #042241;\n  margin-left: 10px;\n}\n.checkout-btn {\n  font-weight: 500;\n  padding: 12px 25px;\n  font-size: 16px;\n  border-radius: 6px;\n}\n</style>"],"mappings":"AAyGA,OAAAA,GAAA;AACA,SAAAC,KAAA;AAEA;EACAC,IAAA;EACAC,KAAA;IACA;MACAC,MAAA;MACAC,kBAAA;MACAC,YAAA;MACAC,YAAA;MACAC,aAAA;QACAC,aAAAC,IAAA;UACA,MAAAC,KAAA,OAAAC,IAAA;UACAD,KAAA,CAAAE,QAAA;UACA,MAAAC,aAAA,OAAAF,IAAA;UACAE,aAAA,CAAAC,OAAA,CAAAD,aAAA,CAAAE,OAAA;UACA,OAAAN,IAAA,CAAAO,OAAA,KAAAN,KAAA,CAAAM,OAAA,MAAAP,IAAA,CAAAO,OAAA,KAAAH,aAAA,CAAAG,OAAA;QACA;MACA;IACA;EACA;EACAC,QAAA;IACAC,YAAA;MACA,OAAAlB,KAAA,CAAAmB,IAAA;IACA;IAEAC,UAAA;MACA,UAAAjB,MAAA;MACA,YAAAA,MAAA,CAAAkB,KAAA;IACA;IACAC,uBAAA;MACA,UAAAJ,WAAA,UAAAA,WAAA,CAAAK,eAAA;MACA,aAAAL,WAAA,CAAAK,eAAA;QACA;UAAA;QACA;UAAA;QACA;UAAA;QACA;UAAA;MACA;IACA;IAEAC,WAAA;MACA,YAAAJ,SAAA,QAAAE,sBAAA;IACA;EACA;EACAG,OAAA;IACA,MAAAC,oBAAA;MAEA,UAAApB,YAAA;QACA,KAAAqB,QAAA,CAAAC,KAAA;QACA;MACA;MAEA,KAAAvB,YAAA;MACA;QACA,MAAAwB,cAAA;UACAC,YAAA,OAAA3B,MAAA,CAAA2B,YAAA;UACAC,UAAA,OAAAzB,YAAA;UACA0B,YAAA,QAAAd,WAAA,CAAAe,EAAA;UACAC,UAAA,OAAA9B;QAEA;QAEA+B,OAAA,CAAAC,GAAA,CAAAP,cAAA;QACA,MAAAQ,QAAA,SAAAtC,GAAA,CAAAuC,aAAA,CAAAT,cAAA;QAEA,IAAAQ,QAAA,CAAAE,IAAA;UACA,KAAAZ,QAAA,CAAAa,OAAA;UACAC,UAAA;YACA,KAAAC,OAAA,CAAAC,IAAA;cAAA1C,IAAA;YAAA;UACA;QACA;MACA,SAAA2B,KAAA;QACA,MAAAgB,YAAA,GAAAhB,KAAA,CAAAS,QAAA,EAAAnC,IAAA,EAAA2C,OAAA;QACA,KAAAlB,QAAA,CAAAC,KAAA,CAAAgB,YAAA;MACA;QACA,KAAAvC,YAAA;MACA;IACA;EACA;EACAyC,QAAA;IACA,MAAAC,UAAA,QAAAC,MAAA,CAAAC,KAAA,CAAA9C,MAAA;IACA,IAAA4C,UAAA;MACA;QACA,KAAA5C,MAAA,GAAA+C,IAAA,CAAAC,KAAA,CAAAJ,UAAA;QACA,KAAAzC,YAAA,QAAA0C,MAAA,CAAAC,KAAA,CAAAG,IAAA;QAGA,MAAAC,YAAA,QAAAlD,MAAA,CAAAmD,oBAAA;QACA,IAAAD,YAAA,mBAAAlD,MAAA,CAAAoD,qBAAA;UACA,KAAAnD,kBAAA;QACA,WAAAiD,YAAA,mBAAAlD,MAAA,CAAAqD,sBAAA;UACA,KAAApD,kBAAA;QACA,gBAAAD,MAAA,CAAAoD,qBAAA;UACA,KAAAnD,kBAAA;QACA,gBAAAD,MAAA,CAAAqD,sBAAA;UACA,KAAApD,kBAAA;QACA;MACA,SAAAqD,CAAA;QACA,KAAA9B,QAAA,CAAAC,KAAA;QACA,KAAAc,OAAA,CAAAC,IAAA;MACA;IACA;MACA,KAAAhB,QAAA,CAAAC,KAAA;MACA,KAAAc,OAAA,CAAAC,IAAA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}